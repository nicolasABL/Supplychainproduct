<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABL Credit | Product Specification Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chosen Palette: ABL Corporate (Slate & Cyan) -->
    <!-- Application Structure Plan: 
         1. Header: Branding and navigation (ABL Credit).
         2. Intro: Brief context of the SCF product.
         3. Interactive Process Map (The Core): Custom HTML stepper.
         4. Transaction Simulator: Funding and Fee calculation (Updated colors).
         5. Ecosystem & Parallel Tracks: Broker/Participant charts (Updated colors).
         6. Footer: Standard copyright.
    -->
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #F9FAFB; /* Light Gray */
            color: #1E293B; /* Dark Slate */
        }
        
        /* Chart Container Styling Rules */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 350px;
            max-height: 400px;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }

        /* Custom scrollbar for data tables */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #F1F5F9; /* Slate-100 */
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #94A3B8; /* Slate-400 */
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #475569; /* Slate-600 */
        }

        /* Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #E2E8F0; /* Slate-200 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        .active-step {
            border-left: 4px solid #0E7490; /* Cyan-700 */
            background-color: #ECFEFF; /* Cyan-50 */
        }
        .inactive-step {
            border-left: 4px solid transparent;
        }
    </style>
</head>
<body class="antialiased selection:bg-cyan-200 selection:text-cyan-900">

    <!-- Navigation -->
    <nav class="bg-slate-800 text-white sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <span class="text-2xl text-cyan-400">‚õìÔ∏è</span>
                    <span class="font-bold text-xl tracking-tight">ABL <span class="text-cyan-400">Credit</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#process-map" class="hover:bg-slate-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">Process Map</a>
                        <a href="#simulator" class="hover:bg-slate-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">Transaction Sim</a>
                        <a href="#ecosystem" class="hover:bg-slate-700 px-3 py-2 rounded-md text-sm font-medium transition-colors">Ecosystem</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="bg-white border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4">ABL Credit Product Specification</h1>
            <p class="text-lg text-slate-600 max-w-3xl leading-relaxed">
                A comprehensive operational blueprint for the ABL Credit application. This platform manages the full lifecycle from client onboarding and legal agreements to transaction funding, collection, and parallel participant management.
            </p>
            <div class="mt-6 flex flex-wrap gap-3">
                <span class="px-3 py-1 rounded-full bg-cyan-100 text-cyan-800 text-sm font-medium border border-cyan-200">End-to-End Workflow</span>
                <span class="px-3 py-1 rounded-full bg-slate-100 text-slate-800 text-sm font-medium border border-slate-200">Risk Mitigation</span>
                <span class="px-3 py-1 rounded-full bg-slate-100 text-slate-800 text-sm font-medium border border-slate-200">Participant Funding</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-16">

        <!-- SECTION 1: Interactive Process Lifecycle -->
        <section id="process-map">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                    <span class="text-cyan-600 text-xl">‚ù∂</span> Process Lifecycle Explorer
                </h2>
                <p class="text-slate-600 mt-2">
                    Explore the six core phases of the ABL Credit product. Click on any phase in the left panel to view the specific data inputs, required documents, and automated system actions defined in the specification.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-auto lg:h-[600px]">
                <!-- Navigation Sidebar (Steps) -->
                <div class="lg:col-span-4 flex flex-col gap-2 overflow-y-auto custom-scroll pr-2" id="step-nav">
                    <!-- Steps will be injected by JS -->
                </div>

                <!-- Detail View Panel -->
                <div class="lg:col-span-8 glass-panel rounded-xl p-6 md:p-8 flex flex-col relative overflow-hidden">
                    <div id="step-content" class="h-full overflow-y-auto custom-scroll">
                        <!-- Content injected by JS -->
                        <div class="flex flex-col items-center justify-center h-full text-slate-400">
                            <span class="text-4xl mb-4">üëÜ</span>
                            <p>Select a process phase to view details.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Transaction Simulator (Chart.js) -->
        <section id="simulator" class="bg-slate-800 rounded-2xl p-6 md:p-10 text-white shadow-xl">
            <div class="mb-8 border-b border-slate-700 pb-6">
                <h2 class="text-2xl font-bold text-white mb-2 flex items-center gap-2">
                    <span class="text-cyan-400 text-xl">‚ù∑</span> Transaction Simulator
                </h2>
                <p class="text-slate-400">
                    Simulate the "Transaction Pending" and "Collection" phases, including the **Trading Fee markup**. Adjust the Purchase Order (PO) value and parameters to see the Gross Invoice Value, Client Reserve, and Net Funding amount.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-slate-700 p-6 rounded-xl border border-slate-600">
                        <label class="block text-xs font-semibold text-cyan-400 uppercase tracking-wider mb-2">PO Amount ($)</label>
                        <input type="number" id="poInput" value="100000" step="5000" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors font-mono text-lg">
                        
                        <label class="block text-xs font-semibold text-cyan-400 uppercase tracking-wider mb-2 mt-6">Trading Fee (Markup %)</label>
                        <input type="range" id="feeInput" min="1" max="10" value="5" class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>1%</span>
                            <span id="feeValueDisplay">5%</span>
                            <span>10%</span>
                        </div>
                        
                        <label class="block text-xs font-semibold text-cyan-400 uppercase tracking-wider mb-2 mt-6">Reserve Requirement (%)</label>
                        <input type="range" id="reserveInput" min="5" max="50" value="20" class="w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-cyan-500">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>5%</span>
                            <span id="reserveValueDisplay">20%</span>
                            <span>50%</span>
                        </div>
                    </div>

                    <div class="bg-slate-700 p-6 rounded-xl border border-slate-600">
                        <h3 class="font-semibold text-white mb-4">Calculated Metrics</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center border-b border-slate-600 pb-2">
                                <span class="text-slate-400 text-sm">Initial PO Value</span>
                                <span class="font-mono font-bold" id="metricPO">$100,000</span>
                            </div>
                            <div class="flex justify-between items-center border-b border-slate-600 pb-2">
                                <span class="text-slate-400 text-sm">Trading Fee (Markup)</span>
                                <span class="font-mono font-bold text-red-400" id="metricFee">$5,000</span>
                            </div>
                            <div class="flex justify-between items-center border-b border-slate-600 pb-2">
                                <span class="text-slate-400 text-sm font-semibold">Gross Invoice Value</span>
                                <span class="font-mono font-bold text-cyan-400" id="metricGrossInvoice">$105,000</span>
                            </div>
                            <div class="flex justify-between items-center border-b border-slate-600 pb-2">
                                <span class="text-slate-400 text-sm">Client Reserve (Escrow)</span>
                                <span class="font-mono font-bold text-cyan-400" id="metricReserve">$20,000</span>
                            </div>
                            <div class="flex justify-between items-center pt-1">
                                <span class="text-slate-400 text-sm font-semibold">ABL Funding (Net)</span>
                                <span class="font-mono font-bold text-green-400" id="metricFunding">$80,000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualizations -->
                <div class="lg:col-span-2 grid grid-cols-1 gap-6">
                    <!-- Chart 1: Funds Waterfall -->
                    <div class="bg-white rounded-xl p-4 text-slate-900">
                        <h4 class="text-sm font-bold text-slate-500 mb-2 uppercase">Funds Flow Analysis</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="fundsChart"></canvas>
                        </div>
                        <p class="text-xs text-center text-slate-400 mt-2">Visual split of the initial PO Value into Reserve Deduction and Net Payout.</p>
                    </div>

                    <!-- Chart 2: Collection Timeline -->
                    <div class="bg-white rounded-xl p-4 text-slate-900">
                        <h4 class="text-sm font-bold text-slate-500 mb-2 uppercase">Projected Collection Timeline</h4>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="collectionChart"></canvas>
                        </div>
                         <p class="text-xs text-center text-slate-400 mt-2">Probability of payment collection phases over 90 days, affected by risk factors (Reserve + Fee).</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Parallel Ecosystems (Plotly) -->
        <section id="ecosystem">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-2">
                    <span class="text-cyan-600 text-xl">‚ù∏</span> Parallel Ecosystem Management
                </h2>
                <p class="text-slate-600 mt-2">
                    The platform manages auxiliary systems alongside the main transaction cycle. <strong>Participants</strong> purchase invoice tranches for yield, while <strong>Brokers</strong> earn commissions on originating client volume.
                </p>
            </div>

            <div class="glass-panel rounded-xl p-1">
                <div class="grid grid-cols-1 lg:grid-cols-4">
                    <!-- Context Side -->
                    <div class="lg:col-span-1 bg-slate-50 p-6 border-r border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-4">System Actions</h3>
                        
                        <div class="mb-6">
                            <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Participant Track</h4>
                            <ul class="text-sm space-y-2 text-slate-600">
                                <li class="flex gap-2"><span class="text-green-600">‚úì</span> Onboard Participant</li>
                                <li class="flex gap-2"><span class="text-green-600">‚úì</span> Track Invoice Sales</li>
                                <li class="flex gap-2"><span class="text-green-600">‚úì</span> Generate Statements</li>
                            </ul>
                        </div>

                        <div>
                            <h4 class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-2">Broker Track</h4>
                            <ul class="text-sm space-y-2 text-slate-600">
                                <li class="flex gap-2"><span class="text-cyan-600">‚úì</span> Calculate Commission</li>
                                <li class="flex gap-2"><span class="text-cyan-600">‚úì</span> Issue Statements</li>
                                <li class="flex gap-2"><span class="text-cyan-600">‚úì</span> Process Payouts</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Plotly Chart -->
                    <div class="lg:col-span-3 p-4 md:p-6 bg-white">
                        <div id="ecosystemPlot" class="w-full h-[400px]"></div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-10 border-t border-slate-700">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm">Generated for ABL Credit Product Specification Analysis.</p>
            <p class="text-xs mt-2 opacity-50">Confidential & Proprietary Design Concept.</p>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        // --- DATA: SCF Process Specification ---
        const scfData = [
            {
                id: 'onboarding',
                title: '1. Client Onboarding',
                icon: 'üìù',
                summary: 'Initial data capture and compliance checks.',
                table: [
                    { action: 'Website Form Submission', input: 'Company Name, Registration, Financials', output: 'Client Profile (Draft)', system: 'Initiate KYC/AML Checks' },
                    { action: 'Document Attachment', input: 'Cert. of Incorp, Board Res, Tax IDs', output: 'Doc Repository Link', system: 'Flag for Internal Review' }
                ]
            },
            {
                id: 'agreements',
                title: '2. Agreements Execution',
                icon: 'ü§ù',
                summary: 'Legal framework establishment.',
                table: [
                    { action: 'Trade Finance Agreement', input: 'Legal Review Approval', output: 'Signed Agreement', system: 'Status -> READY_FOR_TRANSACTION' },
                    { action: 'Escrow Agreement', input: 'Bank Details, Custodian Sig', output: 'Signed Escrow Agreement', system: 'Link Escrow to Client Profile' },
                    { action: 'Personal Guarantee', input: 'Guarantor Details (Optional)', output: 'Signed Guarantee', system: 'Update Risk Profile' }
                ]
            },
            {
                id: 'transaction',
                title: '3. Transaction Requirements',
                icon: '‚ö°',
                summary: 'The core funding cycle, validation gates, and markup calculation.',
                table: [
                    { action: 'PO Client-ABL Executed', input: 'Scanned PO (Client->Buyer)', output: 'PO Record (Approved)', system: 'Check against Client Limits' },
                    { action: 'Invoice ABL-Client', input: 'Scanned Invoice, Trading Fee Rate', output: 'Gross Invoice Record (Issued)', system: 'Calculate Markup Fee & Obligation' },
                    { action: 'Evidence of Delivery', input: 'BOL/AWB, QC Report', output: 'Delivery Proof', system: 'Flag Physically Complete' },
                    { action: 'Transfer Reserve to Escrow', input: 'Bank Confirmation', output: 'Reserve Record (Complete)', system: 'Confirm Reserve Secured (Gatekeeper)' },
                    { action: 'PO ABL-Supplier', input: 'Scanned PO (ABL->Supplier)', output: 'Supplier PO Record', system: 'Prepare Disbursement' }
                ]
            },
            {
                id: 'collection',
                title: '4. Collection Phase',
                icon: 'üîÑ',
                summary: 'Repayment tracking and reconciliation.',
                table: [
                    { action: 'Payment Statement Email', input: 'Schedule Date, Template', output: 'Confirmation Sent', system: 'Auto-email to Obligor' },
                    { action: 'Reconciliation', input: 'Bank Stmt, Transaction IDs', output: 'Recon Report', system: 'Match Funds -> Complete Transaction' },
                    { action: 'Personal Collection', input: 'Activity Log', output: 'Collection Note', system: 'Status -> IN_COLLECTION_1' },
                    { action: 'Legal Collection', input: 'Engagement Docs', output: 'Litigation Status', system: 'Status -> IN_COLLECTION_2' }
                ]
            },
            {
                id: 'participant',
                title: '5. Participant Management',
                icon: 'üë•',
                summary: 'Parallel invoice selling workflow.',
                table: [
                    { action: 'Participation Agreement', input: 'Compliance Approval', output: 'Executed Agreement', system: 'Activate Participant Profile' },
                    { action: 'Sell Invoices', input: 'Tranche Amount, Yield Rate', output: 'Sale Record', system: 'Update ABL Ledger' },
                    { action: 'Generate Statements', input: 'Principal/Interest Data', output: 'PDF Statement', system: 'Scheduled Delivery' }
                ]
            },
            {
                id: 'broker',
                title: '6. Broker Management',
                icon: 'üíº',
                summary: 'Commission tracking workflow.',
                table: [
                    { action: 'Broker Agreement', input: 'Compliance Approval', output: 'Executed Agreement', system: 'Link Broker to Client' },
                    { action: 'Commission Calculation', input: 'Volume, Rate', output: 'Ledger Entry', system: 'Auto-calculate on Funding' },
                    { action: 'Payouts', input: 'Bank Details', output: 'Payment Record', system: 'Initiate ACH/Wire' }
                ]
            }
        ];

        // --- UI LOGIC: Process Explorer ---
        const stepNav = document.getElementById('step-nav');
        const stepContent = document.getElementById('step-content');
        let activeIndex = 0;

        function renderSteps() {
            stepNav.innerHTML = '';
            scfData.forEach((step, index) => {
                const btn = document.createElement('button');
                const isActive = index === activeIndex;
                btn.className = `w-full text-left p-4 rounded-lg transition-all duration-200 flex items-center justify-between group ${
                    isActive ? 'active-step shadow-sm' : 'inactive-step hover:bg-slate-200 bg-slate-100'
                }`;
                btn.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${step.icon}</span>
                        <div>
                            <h3 class="font-bold ${isActive ? 'text-slate-900' : 'text-slate-600'}">${step.title}</h3>
                            <p class="text-xs text-slate-500 truncate max-w-[180px]">${step.summary}</p>
                        </div>
                    </div>
                    <span class="${isActive ? 'text-cyan-600' : 'text-slate-300'}">‚û§</span>
                `;
                btn.onclick = () => {
                    activeIndex = index;
                    renderSteps();
                    renderContent();
                };
                stepNav.appendChild(btn);
            });
        }

        function renderContent() {
            const data = scfData[activeIndex];
            
            // Build Table Rows
            const rows = data.table.map(row => `
                <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                    <td class="py-3 px-4 text-slate-800 font-medium align-top">${row.action}</td>
                    <td class="py-3 px-4 text-slate-600 text-sm align-top">${row.input}</td>
                    <td class="py-3 px-4 text-slate-600 text-sm align-top"><span class="bg-slate-100 px-2 py-1 rounded text-xs border border-slate-200">${row.output}</span></td>
                    <td class="py-3 px-4 text-cyan-700 text-sm italic align-top">${row.system}</td>
                </tr>
            `).join('');

            stepContent.innerHTML = `
                <div class="animate-fade-in">
                    <div class="flex items-center gap-3 mb-6 pb-4 border-b border-slate-200">
                        <span class="text-4xl bg-slate-100 p-3 rounded-xl">${data.icon}</span>
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">${data.title}</h2>
                            <p class="text-slate-500">${data.summary}</p>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider">
                                    <th class="py-3 px-4 rounded-tl-lg">Action Step</th>
                                    <th class="py-3 px-4">Required Input Data</th>
                                    <th class="py-3 px-4">Output / Status</th>
                                    <th class="py-3 px-4 rounded-tr-lg">System Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // --- CHART 1 & 2: Transaction Simulator (Chart.js) ---
        let fundsChart, collectionChart;

        function initCharts() {
            // Funds Waterfall Chart
            const ctxFunds = document.getElementById('fundsChart').getContext('2d');
            fundsChart = new Chart(ctxFunds, {
                type: 'bar',
                data: {
                    labels: [['PO Value'], ['Client Reserve', '(Escrow)'], ['Net Funding', '(Disbursed)']],
                    datasets: [{
                        label: 'Amount ($)',
                        data: [100000, 20000, 80000],
                        // Updated colors: Slate-600 (PO), Cyan-500 (Reserve), Green-500 (Funding)
                        backgroundColor: ['#475569', '#06B6D4', '#22C55E'], 
                        borderRadius: 6,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (items) => items[0].label.replaceAll(',', ' '),
                                label: (ctx) => `$${ctx.raw.toLocaleString()}`
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            grid: { color: '#F1F5F9' },
                            ticks: { callback: (val) => '$' + val/1000 + 'k' }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Collection Timeline Chart
            const ctxCollection = document.getElementById('collectionChart').getContext('2d');
            collectionChart = new Chart(ctxCollection, {
                type: 'line',
                data: {
                    labels: ['Day 0', 'Day 30', 'Day 60', 'Day 90'],
                    datasets: [{
                        label: 'Collection Status Probability',
                        data: [100, 95, 40, 10],
                        // Updated colors: Cyan-500 (Line), Cyan-50 (Fill)
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        annotation: {}
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Payment Probability (%)' }
                        }
                    }
                }
            });
        }

        function updateSimulation() {
            const poVal = parseFloat(document.getElementById('poInput').value) || 0;
            const reservePct = parseInt(document.getElementById('reserveInput').value) || 0;
            const feePct = parseInt(document.getElementById('feeInput').value) || 0;
            
            // Calculations with new Trading Fee
            const feeVal = poVal * (feePct / 100);
            const grossInvoiceVal = poVal + feeVal;
            
            const reserveVal = poVal * (reservePct / 100);
            const fundingVal = poVal - reserveVal;

            // Update UI Text
            document.getElementById('feeValueDisplay').textContent = `${feePct}%`;
            document.getElementById('reserveValueDisplay').textContent = `${reservePct}%`;
            
            document.getElementById('metricPO').textContent = `$${poVal.toLocaleString()}`;
            document.getElementById('metricFee').textContent = `$${feeVal.toLocaleString()}`;
            document.getElementById('metricGrossInvoice').textContent = `$${grossInvoiceVal.toLocaleString()}`;
            
            document.getElementById('metricReserve').textContent = `$${reserveVal.toLocaleString()}`;
            document.getElementById('metricFunding').textContent = `$${fundingVal.toLocaleString()}`;

            // Update Funds Chart (Split based on PO asset)
            fundsChart.data.labels = [['PO Value'], ['Client Reserve', `(${reservePct}%)`], ['Net Funding', '(Disbursed)']];
            fundsChart.data.datasets[0].data = [poVal, reserveVal, fundingVal];
            fundsChart.update();

            // Update Collection Chart (Mock logic: Risk influenced by both reserve and fee)
            const riskFactor = (reservePct + feePct) / 60;
            const baseProb = 90 + (riskFactor * 10);
            collectionChart.data.datasets[0].data = [100, baseProb, baseProb * 0.5, baseProb * 0.1];
            collectionChart.update();
        }

        // --- CHART 3: Ecosystem (Plotly) ---
        function initPlotly() {
            const participants = {
                x: ['Q1', 'Q2', 'Q3', 'Q4'],
                y: [500000, 750000, 1200000, 1800000],
                name: 'Participant Funding Volume',
                type: 'bar',
                // Updated color: Slate-800
                marker: { color: '#1E293B' }
            };

            const brokers = {
                x: ['Q1', 'Q2', 'Q3', 'Q4'],
                y: [25000, 37500, 60000, 90000],
                name: 'Broker Commissions Paid',
                type: 'scatter',
                mode: 'lines+markers',
                yaxis: 'y2',
                // Updated color: Cyan-500
                line: { color: '#06B6D4', width: 3 },
                marker: { size: 8 }
            };

            const layout = {
                font: { family: 'Plus Jakarta Sans', color: '#1E293B' },
                margin: { l: 50, r: 50, t: 30, b: 50 },
                showlegend: true,
                legend: { orientation: 'h', y: 1.1 },
                xaxis: { title: 'Fiscal Quarters' },
                yaxis: { title: 'Funding Volume ($)', side: 'left' },
                yaxis2: {
                    title: 'Commissions ($)',
                    overlaying: 'y',
                    side: 'right',
                    showgrid: false
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            const config = { responsive: true, displayModeBar: false };

            Plotly.newPlot('ecosystemPlot', [participants, brokers], layout, config);
        }

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            renderSteps();
            renderContent();
            // Re-initialize charts to use new colors
            initCharts();
            initPlotly();

            // Event Listeners for Simulator
            document.getElementById('poInput').addEventListener('input', updateSimulation);
            document.getElementById('reserveInput').addEventListener('input', updateSimulation);
            document.getElementById('feeInput').addEventListener('input', updateSimulation);
            
            // Initial calc
            updateSimulation();
        });

    </script>
</body>
</html>
